<div class="main-layout" [class.sidebar-fechada]="!sidebarAberta">

  <aside class="sidebar">
    <div class="menu-icon-toggle" (click)="toggleSidebar()">☰</div>
    
    <div class="sidebar-header">
      </div>
    
    <nav class="sidebar-nav">
      
      <a class="nav-item" 
         [routerLink]="['/dashboard']"
         (click)="navegarEFechar()">
        Dashboard
      </a>
      
      <a class="nav-item active" [routerLink]="['/tickets']" (click)="navegarEFechar()">
        Tickets
      </a>
    </nav>
    
    <button class="btn-sair" (click)="fazerLogout()">sair</button>
  </aside>

  <main class="content-area-tickets">
    <header class="tickets-header">
      
      <form class="search-form" (ngSubmit)="realizarPesquisa()">
          <input 
              type="text" 
              placeholder="Pesquisar..." 
              [(ngModel)]="termoDePesquisa" 
              name="search_term">
          
          <button type="submit" class="btn-search">Pesquisar</button>
      </form>

      <div class="actions">
        <div class="header-title">
            <i class="icon-tickets"></i> 
            Tickets
        </div>
        
        <button class="btn-create" [routerLink]="['/tickets/novo']">Criar uma tarefa</button>
        
        <button class="btn-atualizar-header" (click)="atualizarLista()">Atualizar</button> 
      </div>
    </header>

    <div *ngIf="ultimaAtualizacao" style="text-align: right; font-size: 0.8em; color: #555; padding-bottom: 10px;">
        Última Atualização: {{ ultimaAtualizacao | date:'shortTime' }}
    </div>

    <div class="ticket-list-container">
      <table>
        <thead>
          <tr>
            <th>Código</th>
            <th>Área</th>
            <th>Data Início</th>
            <th>Status</th>
            <th>Dias Restantes</th>
            <th>Problemas</th>
            <th>Atualizar</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ticket of ticketsExibidos">
            <td>{{ ticket.codigo }}</td>
            <td>{{ ticket.area }}</td>
            <td>{{ ticket.dataInicio }}</td>
            <td><span class="status-indicator" [class]="'status-' + ticket.status"></span></td> 
            <td>{{ ticket.diasRestantes }}</td>
            <td>{{ ticket.problemas }}</td>
            <td><button class="edit-btn" (click)="editarTicket(ticket.codigo)">✏️</button></td> 
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="status-popup-simulacao" *ngIf="statusPopUpVisivel">
        <p>Status da Tarefa</p>
        <p>O botão verde significa que a tarefa está concluída.</p>
        <p>O botão amarelo significa que a tarefa ainda está em andamento.</p>
        <p>Se o problema não for resolvido por algum motivo, ou se o campo de dias restantes for maior que o campo de Data de Termino da Tarefa, o status muda automaticamente para vermelho.</p>
        
        <button (click)="fecharStatusPopUp()">Fechar</button>
    </div>
  </main>
</div>
